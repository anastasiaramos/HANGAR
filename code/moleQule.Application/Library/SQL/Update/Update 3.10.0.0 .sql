/* UPDATE 3.8.0.0*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '3.10.0.0' WHERE "NAME" = 'DB_VERSION';

SET SEARCH_PATH = "0001";

ALTER TABLE "Privilege" ADD COLUMN "CREATE" boolean DEFAULT false;
ALTER TABLE "Privilege" ADD COLUMN "MODIFY" boolean DEFAULT false;
ALTER TABLE "Privilege" ADD COLUMN "DELETE" boolean DEFAULT false;

UPDATE "Privilege" SET "CREATE" = true WHERE "WRITE" = true;
UPDATE "Privilege" SET "MODIFY" = true WHERE "WRITE" = true;
UPDATE "Privilege" SET "DELETE" = true WHERE "WRITE" = true;

ALTER TABLE "Privilege" DROP COLUMN "WRITE";

/* UPDATE 3.9.0.0*/

SET SEARCH_PATH = "COMMON";

SET SEARCH_PATH = "0001";

ALTER TABLE "Expediente" RENAME COLUMN "G_TRANS_CUENTA" TO "N_DUA";
UPDATE "Expediente" SET "N_DUA" = '';

ALTER TABLE "Expediente" DROP COLUMN "G_PROV_CUENTA";
ALTER TABLE "Expediente" DROP COLUMN "G_NAV_CUENTA";
ALTER TABLE "Expediente" DROP COLUMN "G_TRANS_DEST_CUENTA";
ALTER TABLE "Expediente" DROP COLUMN "G_DESP_CUENTA";

ALTER TABLE "Producto_Expediente" ADD COLUMN "SERIAL" bigint;
ALTER TABLE "Producto_Expediente" ADD COLUMN "CODIGO" varchar(255);

UPDATE "Producto_Expediente" SET "SERIAL" = C."NROW", "CODIGO" = trim(to_char(C."NROW", '00000'))
FROM (SELECT "OID", ROW_NUMBER() OVER (ORDER BY "OID") AS "NROW"
     FROM "Producto_Expediente" 
     ORDER BY "OID") AS C
WHERE "Producto_Expediente"."OID" = C."OID"; 

/* UPDATE 3.10.0.0*/

SET SEARCH_PATH = "COMMON";

CREATE TABLE "ItemMap"
(
  "OID" bigserial NOT NULL UNIQUE,
  "OID_ITEM" int8 NOT NULL,
  "PRIVILEGE" int8 NOT NULL,
  "OID_ASSOCIATE_ITEM" int8 NOT NULL,
  "ASSOCIATE_PRIVILEGE" int8 NOT NULL,
  CONSTRAINT "ITEMMAP_PK" PRIMARY KEY ("OID")
) WITHOUT OIDS;

ALTER TABLE "ItemMap" OWNER TO moladmin;
GRANT ALL ON TABLE "ItemMap" TO GROUP "MOLEQULE_ADMINISTRATOR";

ALTER TABLE "Proveedor" ADD COLUMN "TIPO" bigint DEFAULT 1;
UPDATE "Proveedor" SET "TIPO" = 1;

ALTER TABLE "Despachante" ADD COLUMN "TIPO" bigint DEFAULT 5;
UPDATE "Despachante" SET "TIPO" = 5;

ALTER TABLE "Naviera" ADD COLUMN "TIPO" bigint DEFAULT 2;
UPDATE "Naviera" SET "TIPO" = 2;

ALTER TABLE "Transportista" ADD COLUMN "TIPO" bigint DEFAULT 3;
UPDATE "Transportista" SET "TIPO" = 3 WHERE "TIPO_TRANSPORTISTA" = 0 OR "TIPO_TRANSPORTISTA" = 1;
UPDATE "Transportista" SET "TIPO" = 4 WHERE "TIPO_TRANSPORTISTA" = 2;

SET SEARCH_PATH = "0001";

ALTER TABLE "Empleado" ADD COLUMN "TIPO" bigint DEFAULT 6;
UPDATE "Empleado" SET "TIPO" = 6;
