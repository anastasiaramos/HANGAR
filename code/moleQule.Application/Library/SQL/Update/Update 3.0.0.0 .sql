/* UPDATE 3.0.0.0*/

SET SEARCH_PATH = "COMMON";

UPDATE "Variable" SET "VALUE" = '3.0.0.0' WHERE "NAME" = 'DB_VERSION';

SET SEARCH_PATH = "0001";

ALTER TABLE "Tema" DROP CONSTRAINT fk_tema_submodulo;

ALTER TABLE "Tema" ADD CONSTRAINT fk_tema_submodulo FOREIGN KEY ("OID_SUBMODULO")
      REFERENCES "0001"."Submodulo" ("OID") MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE "Material_Plan" DROP CONSTRAINT "Material_Plan_OID_REVISION_fkey";

ALTER TABLE "Material_Plan" ADD CONSTRAINT fk_material_plan_revision FOREIGN KEY ("OID_REVISION")
      REFERENCES "0001"."RevisionMaterial" ("OID") MATCH SIMPLE
      ON UPDATE CASCADE ON DELETE CASCADE;

ALTER TABLE "Albaran" DROP CONSTRAINT "UQ_Albaran_CODIGO";

ALTER TABLE "FacturaProveedor" ADD COLUMN "ALBARANES" text;
ALTER TABLE "FacturaProveedor" ADD COLUMN "ID_MOV_CONTABLE" varchar(255);
ALTER TABLE "Pago" ADD COLUMN "ID_MOV_CONTABLE" varchar(255);

ALTER TABLE "Factura" ADD COLUMN "P_IRPF" decimal(10,2);
ALTER TABLE "Proforma" ADD COLUMN "P_IRPF" decimal(10,2);

ALTER TABLE "MovimientoBanco" ADD COLUMN "ESTADO" bigint DEFAULT 1;

UPDATE "MovimientoBanco" SET "ESTADO" = 1;

ALTER TABLE "Factura" ADD COLUMN "ALBARANES" text;
ALTER TABLE "Factura" ADD COLUMN "ID_MOV_CONTABLE" varchar(255);
ALTER TABLE "Cobro" ADD COLUMN "ID_MOV_CONTABLE" varchar(255);

